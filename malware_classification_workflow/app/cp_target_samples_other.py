from shutil import copyfile
import pickle
import os


FROM_PATH = '/home/bensonbair/malware_classification_workflow/raw_data/other_malware/'
DEST_PATH = '/home/bensonbair/malware_classification_workflow/raw_data/experiment_samples_0612/other_malware/'


if __name__ == '__main__':
    
    all_benign_shas = pickle.load(open('malware_shas_need_scp_new.ins.p', 'rb'))
    print(len(all_benign_shas))
    done_shas = [f.replace('.danger', '') for f in os.listdir(DEST_PATH) if f.endswith('.danger')]
    
    to_copy_shas = set(all_benign_shas) - set(done_shas)
    print(len(to_copy_shas))
    
    not_found = []

    for i, sha in enumerate(to_copy_shas):
        # if i != 0:
        #     continue
        filename = '{}.danger'.format(sha)
        src = FROM_PATH + filename
        dst = DEST_PATH + filename
        if os.path.isfile(src) and not os.path.isfile(dst):
            copyfile(src, dst)
        else:
            not_found.append(sha)
            print(sha, 'not copied.')
        pickle.dump(not_found, open('/home/bensonbair/malware_classification_workflow/app/malware_shas_need_scp_new.ins.p', 'wb'))
            






